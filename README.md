# Sick Rats - Chrome Extension Secret Scanner

> **DISCLAIMER: This README was generated by an AI (Claude).**

A tool for scanning Chrome extensions for leaked secrets and credentials using [TruffleHog](https://github.com/trufflesecurity/trufflehog).

## Overview

This project downloads Chrome extension artifacts from an S3 bucket, extracts them, and scans for hardcoded secrets such as API keys, tokens, and credentials.

## Prerequisites

- **AWS CLI** - configured with a `prod` profile
- **TruffleHog** - secret scanning tool (`brew install trufflehog` or see [installation docs](https://github.com/trufflesecurity/trufflehog#installation))
- **fd** - fast file finder (`brew install fd`)
- **Bash** - shell environment

## Quick Start

```bash
# Scan the filesystem (downloads, extracts, and scans)
make scan-filesystem

# Or scan the S3 bucket directly
make scan-bucket
```

## Workflow

The scanning process follows these steps:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Download   â”‚ --> â”‚   Unzip     â”‚ --> â”‚    Scan     â”‚ --> â”‚   Analyze   â”‚
â”‚  Artifacts  â”‚     â”‚   CRX Files â”‚     â”‚  for Secretsâ”‚     â”‚   Results   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Step 1: Download Extensions

```bash
make download COUNT=100
```

Downloads Chrome extension `.crx` files from the S3 bucket (`prod-classy-fire-artifacts`).

- **Default count:** 100 extensions
- **Output:** `artifacts/` directory
- **Parallelism:** 10 concurrent downloads

### Step 2: Unzip Extensions

```bash
make unzip
```

Extracts relevant files from the `.crx` archives:
- JavaScript files (`*.js`)
- JSON files (`*.json`)
- HTML files (`*.html`)
- Markdown files (`*.md`, `*.mdx`)
- CSS files (`*.css`)

**Output:** `extensions/<extension_id>/` directories

### Step 3: Scan for Secrets

```bash
# Scan local filesystem
make scan-filesystem

# Or scan S3 bucket directly
make scan-bucket
```

Runs TruffleHog to detect secrets. The scanner looks for:
- API keys (OpenAI, AWS, Google, etc.)
- Access tokens (Twitch, Telegram, etc.)
- Private keys
- Database credentials
- And many more...

### Step 4: Clean Up

```bash
make clean
```

Removes all downloaded and extracted files:
- `objects.txt`
- `artifacts/`
- `extensions/`

## Reading Scan Results

### Output Format

Each finding in the scan output contains:

```
âœ… Found verified result ğŸ·ğŸ”‘
Detector Type: OpenAI
Decoder Type: PLAIN
Raw result: sk-proj-xxx...
File: extensions/<extension_id>/path/to/file.js
Line: 87
```

### Result Types

| Indicator | Meaning |
|-----------|---------|
| `âœ… Found verified result ğŸ·ğŸ”‘` | Secret was verified as active/valid |
| `Found unverified result ğŸ·ğŸ”‘â“` | Secret pattern found but not verified |
| `(Verification info cached)` | Verification result from cache |

### Key Fields

- **Detector Type:** The type of secret (OpenAI, AWS, Telegram, etc.)
- **Decoder Type:** How the secret was encoded (PLAIN, BASE64, etc.)
- **Raw result:** The actual secret value found
- **File:** Path to the file containing the secret
- **Line:** Line number where the secret was found

### Saving Results

To save scan results to a file:

```bash
make scan-filesystem > scan.txt 2>&1
```

### Analyzing Results

Count secrets per extension:

```bash
grep "File: extensions/" scan.txt | \
  sed -E 's/.*File: extensions\/([^\/]+)\/.*/\1/' | \
  sort | uniq -c | sort -rn
```

Count by secret type:

```bash
grep "Detector Type:" scan.txt | \
  sort | uniq -c | sort -rn
```

Find only verified secrets:

```bash
grep -A 10 "âœ… Found verified result" scan.txt
```

## Directory Structure

```
sick-rats/
â”œâ”€â”€ Makefile              # Build commands
â”œâ”€â”€ README.md             # This file
â”œâ”€â”€ scripts/
â”‚   â”œâ”€â”€ clean.sh          # Cleanup script
â”‚   â”œâ”€â”€ download.sh       # S3 download script
â”‚   â”œâ”€â”€ scan.sh           # TruffleHog wrapper
â”‚   â””â”€â”€ unzip.sh          # CRX extraction script
â”œâ”€â”€ artifacts/            # Downloaded CRX files (generated)
â”œâ”€â”€ extensions/           # Extracted extensions (generated)
â”œâ”€â”€ responses/            # API response samples
â””â”€â”€ scan.txt              # Scan results (generated)
```

## Configuration

### Environment Variables

| Variable | Default | Description |
|----------|---------|-------------|
| `COUNT` | 100 | Number of extensions to download |
| `AWS_PROFILE` | prod | AWS profile for S3 access |

### Customizing the Scan

Pass additional TruffleHog options:

```bash
# Only show verified results
bash scripts/scan.sh filesystem --only-verified

# Output as JSON
bash scripts/scan.sh filesystem --json

# Include specific detectors only
bash scripts/scan.sh filesystem --include-detectors="openai,aws"
```

## Makefile Targets

| Target | Description |
|--------|-------------|
| `make download` | Download extensions from S3 |
| `make unzip` | Extract CRX files |
| `make scan-filesystem` | Scan extracted extensions |
| `make scan-bucket` | Scan S3 bucket directly |
| `make clean` | Remove generated files |

## Troubleshooting

### "Artifacts directory already exists"

The scan script skips downloading if `artifacts/` exists. To re-download:

```bash
make clean
make scan-filesystem
```

### AWS Credentials Error

Ensure your AWS profile is configured:

```bash
aws configure --profile prod
```

### TruffleHog Not Found

Install TruffleHog:

```bash
# macOS
brew install trufflehog

# Or via Go
go install github.com/trufflesecurity/trufflehog/v3@latest
```

## Security Notice

This tool is intended for security research and identifying leaked credentials in browser extensions. If you find active secrets:

1. **Do not use** the credentials
2. **Report** to the extension developer
3. **Document** findings responsibly

---

> **DISCLAIMER: This README was generated by an AI (Claude).**
